<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DNR Adressensuche</title>

<style>
body {
  font-family: Arial, sans-serif;
  background-color: #f9f9f9;
  padding: 20px;
}

h2 {
  text-align: center;
  color: #333;
}

input {
  display: block;
  margin: 0 auto;
  padding: 12px;
  font-size: 18px;
  width: 90%;
  max-width: 300px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

p#noResults {
  text-align: center;
  color: #d9534f;
  font-weight: bold;
}

table {
  border-collapse: collapse;
  width: 100%;
  max-width: 700px;
  margin: 20px auto;
  background-color: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 10px;
  white-space: nowrap;
}

th {
  background-color: #0078D4;
  color: #fff;
}

/* ðŸ”´ðŸŸ  Farbcodes */
.orange {
  background-color: #fff3cd;
}

.red {
  background-color: #f8d7da;
}
</style>
</head>

<body>

<h2>DNR Adressensuche</h2>

<input type="text" id="plzInput" placeholder="PLZ eingeben / enter ZIP">

<p id="noResults"></p>

<table>
  <thead>
    <tr>
      <th>StraÃŸe</th>
      <th>Ort</th>
      <th>PLZ</th>
      <th>Danger</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
fetch("DNR_Adressen.csv")
  .then(res => res.text())
  .then(text => {

    const rows = text.trim().split("\n").slice(1);

    // ðŸ”¹ Regroupement des adresses
    const map = {};

    rows.forEach(r => {
      const [street, city, zip] = r.split(";").map(c => c.trim());
      const key = `${street}|${city}|${zip}`;

      if (!map[key]) {
        map[key] = { street, city, zip, count: 1 };
      } else {
        map[key].count++;
      }
    });

    const data = Object.values(map);
    const tbody = document.getElementById("tableBody");
    const msg = document.getElementById("noResults");

    document.getElementById("plzInput").addEventListener("input", function () {
      const plz = this.value.replace(/\D/g, "");
      tbody.innerHTML = "";
      let found = false;

      data.forEach(addr => {
        if (addr.zip.replace(/\D/g, "") === plz) {
          let cls = "";
          if (addr.count >= 2 && addr.count <= 3) cls = "orange";
          if (addr.count > 3) cls = "red";

          tbody.innerHTML += `
            <tr class="${cls}">
              <td>${addr.street}</td>
              <td>${addr.city}</td>
              <td>${addr.zip}</td>
              <td style="text-align:center">
                <input type="checkbox">
              </td>
            </tr>
          `;
          found = true;
        }
      });

      msg.textContent = found ? "" : "Keine Adresse gefunden / No address found, area safe ðŸ™‚";
    });
  });
</script>

</body>
</html>
